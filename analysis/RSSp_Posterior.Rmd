---
title: "RSSp for Prediction"
author: "Nicholas Knoblauch"
date: 2017-10-20
output: html_document
---

<!-- The file analysis/chunks.R contains chunks that define default settings
shared across the workflowr files. -->
```{r read-chunk, include=FALSE, cache=FALSE}
knitr::read_chunk("chunks.R")
```

<!-- Update knitr chunk options -->
```{r knitr-opts-chunk, include=FALSE}
```

<!-- Insert the date the file was last updated -->
```{r last-updated, echo=FALSE, results='asis'}
```

<!-- Insert the code version (Git commit SHA1) if Git repository exists and R
 package git2r is installed -->
```{r code-version, echo=FALSE, results='asis'}
```

<!-- Add your analysis here -->

## Deriving the RSSp Posterior ##


$$ \textbf{u} \sim N(0,I_p\sigma^2_u)$$
$$\hat{\textbf{u}}|\textbf{u} \sim N(R\textbf{u},R+cI_p)$$
From Bishop's, _Pattern Recognotion and Machine Learning_ we get
$$ \hat{\textbf{u}} \sim N(0,\sigma_u^2R^2+R+cI_p)$$

as well as the posterior

$$ \textbf{u} \sim N(\Sigma R  (R+cI_p)^{-1}\hat{\textbf{u}},\Sigma)$$
Where $$\Sigma = (\frac{1}{\sigma^2_u} I_p +R (R+cI_p)^{-1}R)^{-1}$$


Given the EVD of R, $R=QDQ^{T}$, Let's denote $D^\ast=D+cI_p=\text{diag}(\lambda_i+c)$, this means that $(R+cI_p)^{-1}= (QDQ^{T}+cIp)^{-1}=QD^{\ast^{-1}}Q^{T}=Q \text{diag}(\frac{1}{\lambda_j+c})Q^{T}$.  
$$\Sigma= (\frac{1}{\sigma^2_u} I_p+QDQ^{T}QD^{\ast^{-1}}Q^{T}QDQ^{T})^{-1}=(\frac{1}{\sigma^2_u} I_p+QDD^{\ast^{-1}}DQ^{T})^{-1}=\frac{1}{\sigma_u^2}I_p + Q\text{diag}(\frac{\lambda_j^2}{\lambda_j+c})Q^{T})^{-1}$$
We can repeat the same trick as before to  simplify $\Sigma$ further:

$$\Sigma=QD^{\ast\ast^{-1}}Q^{T}$$ where


$$D^{\ast\ast}=\frac{1}{\sigma_u^2}I_p+ D^2D^{\ast^{-1}}=\text{diag}(\frac{1}{\sigma_u^2}+\frac{\lambda_j^2}{\lambda_j+c})=\text{diag}(\frac{\sigma_u^2(c+\lambda_j)}{c+\lambda_j^2\sigma_u^2+\lambda_j})^{-1}$$

Simplifying further:

$$\textbf{u}|\hat{\textbf{u}} \sim N(Q D^{\ast \ast^{-1}} Q^{T}QDQ^{T}QD^{\ast^{-1}}Q^{T}\hat{\textbf{u}},QD^{\ast \ast^{-1}}Q^{T})$$

$$ \Rightarrow N(QD^{\ast \ast^{-1}} D D^{\ast^{-1}}Q^{T},QD^{\ast\ast^{-1}}Q^{T})  $$

$$\Rightarrow N(QD^{\ast \ast \ast}Q^{T}\hat{\textbf{u}},QD^{\ast \ast^{-1}}Q^{T})$$


with 
$$D^{\ast \ast \ast} = D^{\ast \ast^{-1}} D D^{\ast^{-1}} =\text{diag}(\frac{\sigma_u^2(c+\lambda_j)}{c+\lambda_j^2\sigma_u^2+ \lambda_j} \times \lambda_j \times \frac{1}{\lambda+c}) = \text{diag}(\frac{\lambda_j \sigma^2_u}{c+\lambda_j^2\sigma_u^2+\lambda_j})$$




## Session information




<!-- Insert the session information into the document -->
```{r session-info}
```
